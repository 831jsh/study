TL;DR
=====

도커가 시작될 때 호스트 머신에 docker0이라 불리는 가상 인터페이스를 생성합니다. 
랜덤으로 실행되는 호스트에서 RFC 1918 기준으로 private한 범위에서 ip 주소와 서브넷를 선택합니다.  
그리고 아이피를 docker0에 할당합니다. 도커가 시작되기 몇 분 전에 도커는 172.17.42.1/16 중에 하나를 선택합니다.  
예를 들어 16 bit netmask는 호스트머신과 컨테이너를 위해 65,534 주소를 제공합니다.
맥 어드레스는 ARP 충돌을 피하고 할당된 컨테이너의 ip어드레스를 사용하기 위해  2 66 172 17 0 0 ~ 2 66 172 17 255 255 범위에서 생성됩니다. 

docker0은 평범한 인터페이스는 아닙니다. 
자동으로 다른 접근 가능한 네트워크 인터페이스와 패킷 포워드를 하기위한 가상 이더넷 브릿지 입니다. 
컨테이너가 호스트 머신과 다른 것들과 통신을 가능케 합니다. 

도커는 매번 컨테이너를 만들 때 한쪽에서 패킷을 보내고 다른 쪽에서 받을 수 있는 파이프와 같은 짝을 이루는 peers 인터페이스를 생성합니다. 
컨테이너를 위한 peer는 vethAQI2QT와 같은 유일한 이름을 주어 eth0 인터페이스가 되고 다른 피어와 연결을 유지합니다. 
모든 veth* 인터페이스는 docker0 브릿지와 바인딩에 의해 도커는 호스트 머신과 모든 도커 컨테이너와 공유된 가상 subnet을 생성합니다. 

Configuring DNS
===============
도커는 호스트네임과 DNS 설정을 어떻게 지원할까요? 최신 정보를 작성할 수 있도록 가상화한 파일을 etc에 오버레이합니다.  
실행 중인 컨테이너에서 mount 명령어를 치면 볼 수 있습니다. 

도커는 resolv.conf(네임서버 정보가 담겨있음) 를 호스트 머신이 새로운 DHCP 정보를 받을 때 최신 상태로 유지시킵니다. 이 방식에 대한 정보는 도커 다음 버전에서 
변경될 수도 있으니 파일은 수정하지 말고 옵션을 사용하도록 합니다. 

- -h, --hostname /etc/hostname과 /etc/hosts에 설정됨, 프롬프트에도 이 이름으로 보임, 하지만 다른 컨테이너나 데몬에서는 볼 수 없음
- --link 이 옵션을 사용하면 /etc/hosts에 ip와 alias 정보가 기록된다. 컨테이너가 재실행하면 link 정보는 변경되지 않는다. 
- --dns 옵션을 사용하면 /etc/resolv.conf의 정보로 기록된다. 
- --dns-search 옵션을 사용하면 dns 정보를 서치해 /etc/resolv.conf에 기록한다. 

Communication between containers and the wider world
====================================================

호스트 머신은 어떻게 ip 패킷 포워드를 할 수 있는가 , ip_forard 시스템 파라미터에 의해 결정됩니다. 
만약 파라메터가 1(true)이면 컨테이너들 끼리 패킷은 전달됩니다. 보통 Docker 서버를 떠나 true로 설정하고 쓸 것이며 도커는 1로 설정합니다. 

Communication between containers
================================

- 컨테이너의 네트워크 인터페이스의 네트워크 토폴리지는 ? 디폴트로 도커는 모든 컨테이너를 패킷을 보내기 위해 docker0 브릿지로 연결합니다. 
- iptables는 이 특별한 연결을 어떻게 생성할까요 ? 도커는 데몬이 시작할 때 iptables=false라면 시스템의 iptables를 변경하지 않습니다. 반면에 토커 서버는 포워드 체인에 icc가 true이면 ACCEPT를 false이면 DROP 룰을 추가합니다.  

icc가 true이든 false로 변경이되는 걸 떠나 전략적인 질문이다. iptables은 호스트와 다른 컨테이너를 접근되는 임의의 포트로 보호합니다. 가장 보안적인 설정인 icc=false를 선택했다면, 이 경우 다른 서비스를 제공하기 위해 컨테이너 통신은 어떻게 할 수 있을까요 ?

이 질문에 답은 --link옵션입니다. 만약 icc=false iptables=true로 도커 데몬이 실행 중이라면, 도커 서버는 새로운 컨테이너에 연결할 수있도록 포트를 노출하고 iptables에 ACCEPT룰을 추가합니다. 

iptables 커맨드를 통해 포워드 체인이 도커 호스트에서 확인이 가능하다.

Binding container ports to the host
===================================

도커 컨테이너는 디폴트로 외부와 연결을 생성할 수 있다. 그러나 외부는 컨테이너로 연결할 수 없습니다. 
도커 서버가 시작할 때 iptables에 masquerading(가상 아이피로 외부와 통신이 가능하게 하는 옵션 룰을 호스트머신에 생성한 덕분에 외부와의 연결이 보일겁니다. 

그러나 도커 컨테이너로 인커밍 연결을 가능하게 하려면 특별한 옵션이 있습니다. 2가지 접근방법이 있습니다.

- 
